
# FusionCode Architecture Documentation

##  System Architecture Overview

FusionCode is a real-time collaborative code editor built on a client-server architecture using WebSocket technology for bi-directional communication.

```
┌─────────────────────────────────────────────────────────────────┐
│                         FUSIONCODE SYSTEM                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌───────────────┐              ┌────────────────────┐          │
│  │               │◄────────────►│                    │          │
│  │   Client A    │   WebSocket  │   Express Server   │          │
│  │               │              │   + Socket.IO      │          │
│  └───────────────┘              │                    │          │
│                                 │   Port: 3000       │          │
│  ┌───────────────┐              │                    │          │
│  │               │◄────────────►│                    │          │
│  │   Client B    │   WebSocket  └────────────────────┘          │
│  │               │                                              │
│  └───────────────┘              ┌────────────────────┐          │
│                                 │                    │          │
│  ┌───────────────┐              │  Clerk Auth API    │          │
│  │               │◄────────────►│  (External)        │          │
│  │   Client C    │   HTTPS      │                    │          │
│  │               │              └────────────────────┘          │
│  └───────────────┘                                              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

##  Architecture Layers

### 1. **Presentation Layer** (Frontend - React)

```
┌─────────────────────────────────────────────────────────────┐
│                    PRESENTATION LAYER                       │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐       │
│  │   Header     │  │   Footer     │  │   Routing    │       │
│  │  Component   │  │  Component   │  │   (React     │       │
│  │              │  │              │  │   Router)    │       │
│  └──────────────┘  └──────────────┘  └──────────────┘       │
│                                                             │
│  ┌──────────────────────────────────────────────────────┐   │
│  │                 PAGE COMPONENTS                      │   │
│  ├──────────────────────────────────────────────────────┤   │
│  │                                                      │   │
│  │  Home.jsx                EditorPage.jsx              │   │
│  │  ┌────────────────┐      ┌─────────────────────┐     │   │
│  │  │ - Room Creation│      │ - Socket Connection │     │   │
│  │  │ - Room Join    │      │ - User Management   │     │   │
│  │  │ - Auth Check   │      │ - Code Sync         │     │   │
│  │  └────────────────┘      └─────────────────────┘     │   │
│  │                                                      │   │
│  └──────────────────────────────────────────────────────┘   │
│                                                             │
│  ┌──────────────────────────────────────────────────────┐   │
│  │              UI COMPONENTS                           │   │
│  ├──────────────────────────────────────────────────────┤   │
│  │                                                      │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────┐    │   │
│  │  │ CodeEditor   │  │ LeftSideBar  │  │ Terminal │    │   │
│  │  │ (CodeMirror) │  │ (User List)  │  │ (Output) │    │   │
│  │  └──────────────┘  └──────────────┘  └──────────┘    │   │
│  │                                                      │   │
│  │  ┌──────────────────────────────────────────────┐    │   │
│  │  │         RightSideBar                         │    │   │
│  │  │  ┌────────────────────────────────────┐      │    │   │
│  │  │  │   Split View (Resizable)           │      │    │   │
│  │  │  │  ┌──────────────┐                  │      │    │   │
│  │  │  │  │ CodeEditor   │  65%             │      │    │   │
│  │  │  │  └──────────────┘                  │      │    │   │
│  │  │  │  ┌──────────────┐                  │      │    │   │
│  │  │  │  │ Terminal     │  35%             │      │    │   │
│  │  │  │  └──────────────┘                  │      │    │   │
│  │  │  └────────────────────────────────────┘      │    │   │
│  │  └──────────────────────────────────────────────┘    │   │
│  │                                                      │   │
│  └──────────────────────────────────────────────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘

```
## Step-by-Step Event Flow 

```
 ┌────────────────────┐        ① User types in CodeMirror
 │  CLIENT A (You)    │────────────────────────────────────────────┐
 │                    │   emit('CODE_CHANGE', {roomID, code})      │
 └────────────────────┘                                            │
                                                                   ▼
                                                        ┌────────────────────┐
                                                        │   SERVER (Socket)  │
                                                        │                    │
                                                        │  on('CODE_CHANGE') │
                                                        │   → broadcast to   │
                                                        │   socket.in(roomID)│
                                                        └────────────────────┘
                                                                   │
                                                                   |
 ┌────────────────────┐     ② Server sends to other                ▼
 │ CLIENT B (Other)   │◄────────────────────────────────────────────
 │                    │  on('CODE_CHANGE', {code})       
 │  setLocalCode()    │  → update CodeMirror             
 │  setCode()         │                                  
 └────────────────────┘                                


```

## When a New User Joins
```
    ③ CLIENT C joins the room
             │
             ▼
   ┌──────────────────────────┐
   │ SERVER emits('JOINED')   │
   └──────────────────────────┘
             │
             ▼
   ┌─────────────────────────┐
   │ CLIENT A/B handle JOINED│
   │                         │
   │ emit('SYNC_CODE', {     │
   │   code: currentCode,    │
   │   socketId: newUserId   │
   │ })                      │
   └─────────────────────────┘
             │
             ▼
   ┌──────────────────────────┐
   │ SERVER receives          │
   │ on('SYNC_CODE')          │
   │ → io.to(socketId)        │
   │   .emit('CODE_CHANGE')   │
   └──────────────────────────┘
             │
             ▼
   ┌──────────────────────────┐
   │ CLIENT C receives        │
   │ on('CODE_CHANGE')        │
   │ setLocalCode(code)       │
   │ setCode(code)            │
   └──────────────────────────┘

```